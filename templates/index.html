<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: auto; }
        .form-section { margin-bottom: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .form-section h3 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
        input[type="text"], input[type="date"], input[type="time"], select { width: 100%; padding: 8px; margin: 5px 0 10px 0; display: inline-block; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ’ç¨‹ AI æ§åˆ¶é¢æ¿</h1>
        <p>ä»Šå¤©æ˜¯ï¼š{{ today_date }}</p>

        <div class="form-section">
            <h3>æ–°å¢å–®æ¬¡ä»»å‹™ (Add Task)</h3>
            <form action="{{ url_for('add_task_route') }}" method="post">
                <label for="name">ä»»å‹™åç¨±:</label>
                <input type="text" id="name" name="name" required><br>

                <label for="date">æ—¥æœŸ (YYYY-MM-DD):</label>
                <input type="date" id="date" name="date" required value="{{ today_date }}"><br>
                
                <label for="is_fixed">å›ºå®šæ™‚é–“? (y/n):</label>
                <select id="is_fixed" name="is_fixed">
                    <option value="n">N (å¾…è¾¦äº‹é … - éœ€å¡«å¯«é ä¼°å°æ™‚)</option>
                    <option value="y">Y (å›ºå®šè¡Œç¨‹ - éœ€å¡«å¯«èµ·è¨–æ™‚é–“)</option>
                </select><br>

                <label for="start_time">èµ·å§‹æ™‚é–“ (HH:MM):</label>
                <input type="time" id="start_time" name="start_time"><br>

                <label for="end_time">çµæŸæ™‚é–“ (HH:MM):</label>
                <input type="time" id="end_time" name="end_time"><br>

                <label for="estimated_time">é ä¼°å°æ™‚ (éå›ºå®šä»»å‹™):</label>
                <input type="text" id="estimated_time" name="estimated_time" value="1.0"><br>

                <label for="priority">å„ªå…ˆç´š (1-5):</label>
                <input type="text" id="priority" name="priority" value="3"><br>

                <button type="submit">æ–°å¢ä»»å‹™ä¸¦åŒæ­¥è‡³ GCal</button>
            </form>
        </div>

        <div class="form-section">
            <h3>AI æ’ç¨‹æ§åˆ¶</h3>
            <p>
                <button onclick="fetch('/run_ai_decompose')">ğŸ¤– åŸ·è¡Œ Phase 1 (ä»»å‹™åˆ†è§£)</button>
                <br><small>å°‡é«˜é›£åº¦ä»»å‹™æ‹†è§£ç‚ºå­ä»»å‹™ï¼Œä¸¦æ–°å¢åˆ° tasks.json å’Œ GCalã€‚</small>
            </p>
            <p>
                <button onclick="fetch('/run_ai_schedule')">ğŸ¤– åŸ·è¡Œ Phase 2 (æ—¥æ’ç¨‹)</button>
                <br><small>æ’ç¨‹ä»Šå¤©çš„ To-Do List ä¸¦å¯«å…¥ calendar.jsonã€‚</small>
            </p>
        </div>

        <div class="form-section">
            <h3>åˆªé™¤äº‹ä»¶ (Delete by ID)</h3>
            <input type="text" id="delete_id" placeholder="è¼¸å…¥è¦åˆªé™¤çš„ event_id">
            <button onclick="deleteEvent()">ğŸ—‘ï¸ åˆªé™¤</button>
            <p id="delete-status"></p>
        </div>
    </div>

    <script>
        function deleteEvent() {
            const id = document.getElementById('delete_id').value;
            const statusDiv = document.getElementById('delete-status');
            
            if (!id) {
                statusDiv.innerText = 'è«‹è¼¸å…¥äº‹ä»¶ IDï¼';
                return;
            }

            fetch('/delete_event', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `event_id=${id}`
            })
            .then(response => response.json())
            .then(data => {
                statusDiv.innerText = data.message;
                if (data.success) {
                    statusDiv.style.color = 'green';
                } else {
                    statusDiv.style.color = 'red';
                }
            })
            .catch(error => {
                statusDiv.innerText = `ç™¼ç”Ÿç¶²è·¯éŒ¯èª¤: ${error}`;
                statusDiv.style.color = 'red';
            });
        }
        
        // ç°¡å–®è™•ç† AI å•Ÿå‹•çš„å›è¦†
        function fetch(url) {
            window.alert(`æ­£åœ¨å‘¼å« ${url}ï¼Œè«‹æŸ¥çœ‹çµ‚ç«¯æ©Ÿ (Terminal) è¼¸å‡ºçµæœ...`);
            fetch(url)
            .then(response => response.json())
            .then(data => {
                window.alert(`æ“ä½œå®Œæˆï¼š${data.message}`);
                console.log(data);
            })
            .catch(error => {
                window.alert(`æ“ä½œå¤±æ•—ï¼š${error}`);
            });
        }
    </script>
</body>
</html>